<!DOCTYPE HTML>
<html>

<head>
	<meta charset="utf-8">
	<meta name="renderer" content="webkit|ie-comp|ie-stand">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport"
		content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
	<meta http-equiv="Cache-Control" content="no-siteapp" />
	<link rel="Bookmark" href="./ico/logo.png">
	<link rel="Shortcut Icon" href="./ico/logo.png" />
	<!--[if lt IE 9]>
<script type="text/javascript" src="lib/html5shiv.js"></script>
<script type="text/javascript" src="lib/respond.min.js"></script>
<![endif]-->
	<!-- <link rel="stylesheet" href="../third-party/bootstrap/css/bootstrap.min.css"> -->
	<link rel="stylesheet" type="text/css" href="./static/h-ui/css/H-ui.min.css" />
	<link rel="stylesheet" type="text/css" href="./static/h-ui.admin/css/H-ui.admin.css" />
	<link rel="stylesheet" type="text/css" href="./lib/Hui-iconfont/1.0.8/iconfont.css" />
	<link rel="stylesheet" type="text/css" href="./static/h-ui.admin/skin/dolphinColor/skin.css" id="skin" />
	<link rel="stylesheet" type="text/css" href="./static/h-ui.admin/css/style.css" />
	<link rel="stylesheet" href="../css/dialog.css">
	<link rel="stylesheet" href="css/global.css">
	<!--[if IE 6]>./
<script type="text/javascript" src="lib/DD_belatedPNG_0.0.8a-min.js" ></script>
<script>DD_belatedPNG.fix('*');</script>
<![endif]-->
	<title>DolphinBD Manager System</title>
	<meta name="keywords" content="DolphinBD 高性能 时序数据库">
	<meta name="description"
		content="DolphinDB是由浙江智臾科技有限公司研发的一款高性能分布式时序数据库，集成了功能强大的编程语言和高容量高速度的流数据分析系统，为海量结构化数据的快速存储、检索、分析及计算提供一站式解决方案，适用于量化金融及工业物联网等领域。">
	<style>
		.row {
			margin: 15px;
		}
	</style>
</head>

<body>

	<header class="navbar-wrapper">
		<div class="navbar navbar-fixed-top">
			<div class="container-fluid cl"> <a class="logo navbar-logo f-l mr-10 hidden-xs"
					href="https://www.dolphindb.cn/">DolphinDB</a>
				<span class="logo navbar-slogan f-l mr-10 hidden-xs">Manager System</span>
				<nav id="Hui-userbar" class="nav navbar-nav navbar-userbar hidden-xs">
					<ul class="cl">
						<li><a class="navbar-link" href="login.html" id="btnLogin">Login</a></li>

						<li class="dropDown right dropDown_hover">
							<a href="#" class="dropDown_A" id="btnAdmin"></a>
							<ul class="dropDown-menu menu radius box-shadow">
								<li><a href="#" id="changePassword">Password</a></li>
								<li><a href="#" id="btnLogout">logout</a></li>
							</ul>
						</li>

						<li class="dropDown right dropDown_hover">
							<a href="#" class="dropDown_A" id="btnInformation"><i class="Hui-iconfont">&#xe6cd;</i></a>
							<ul class="dropDown-menu menu radius box-shadow">

								<li><a href="#" id="btnLicense">License</a></li>
								<li><a href="#" id="btnVersion">Version</a></li>
							</ul>
						</li>
					</ul>
				</nav>
			</div>
		</div>
	</header>


	<aside class="Hui-aside">
		<div class="menu_dropdown bk_2" id="menunav_dropdown">
			<dl id="menu-dfs">
				<dt><i class="Hui-iconfont">&#xe72b;</i> DFS Manager<i
						class="Hui-iconfont menu_dropdown-arrow">&#xe6d5;</i>
				</dt>
				<dd>
					<ul>
						<li><a data-href="/dfsExplorer.html" data-title="DFS Explore" href="javascript:void(0)">DFS
								Explore</a></li>
					</ul>
				</dd>
			</dl>
			<dl id="menu-memory">
				<dt><i class="Hui-iconfont">&#xe629;</i> Memory Manager<i
						class="Hui-iconfont menu_dropdown-arrow">&#xe6d5;</i>
				</dt>
				<dd>
					<ul>
						<li><a data-href="/sessionUsage.html" data-title="Sessions Usage"
								href="javascript:void(0)">Sessions Usage</a></li>
						<li><a data-href="/variableUsage.html" data-title="Variables Usage"
								href="javascript:void(0)">Variables Usage</a></li>
					</ul>
				</dd>
			</dl>
			<dl id="menu-stramingData">
				<dt><i class="Hui-iconfont">&#xe61e;</i> Stream Manager<i
						class="Hui-iconfont menu_dropdown-arrow">&#xe6d5;</i>
				</dt>
				<dd>
					<ul>
						<li><a data-href="./pubConns.html" data-title="pubConns" href="javascript:void(0)">pubConns</a>
						</li>
						<li><a data-href="./subConns.html" data-title="subConns" href="javascript:void(0)">subConns</a>
						</li>
						<li><a data-href="./pubTables.html" data-title="pubTables"
								href="javascript:void(0)">pubTables</a>
						</li>
						<li><a data-href="./subWorkers.html" data-title="subWorkers"
								href="javascript:void(0)">subWorkers</a>
						</li>
					</ul>
				</dd>
			</dl>
			<dl id="menu-work">
				<dt><i class="Hui-iconfont">&#xe623;</i> Work Manager<i
						class="Hui-iconfont menu_dropdown-arrow">&#xe6d5;</i>
				</dt>
				<dd>
					<ul>
						<li><a data-href="./sumitJobs.html" data-title="Submit" href="javascript:;">Submit</a>
						</li>
						<li><a data-href="./scheduledJobs.html" data-title="Scheduled" href="javascript:;">Scheduled</a>
						</li>
						<li><a data-href="./consoleJobs.html" data-title="Console" href="javascript:;">Console</a>
						</li>

					</ul>
				</dd>
			</dl>
			<dl id="menu-functionView">
				<dt><i class="Hui-iconfont">&#xe61c;</i> FuncView Manager<i
						class="Hui-iconfont menu_dropdown-arrow">&#xe6d5;</i>
				</dt>
				<dd>
					<ul>
						<li><a data-href="/functionView.html" data-title="Function View" href="javascript:;">Function
								View</a></li>

					</ul>
				</dd>
			</dl>
			<dl id="menu-admin">
				<dt><i class="Hui-iconfont">&#xe62d;</i> Access Manager<i
						class="Hui-iconfont menu_dropdown-arrow">&#xe6d5;</i>
				</dt>
				<dd>
					<ul>
						<li><a data-href="/user.html" data-title="Users" href="javascript:void(0)">Users</a></li>
						<li><a data-href="/group.html" data-title="Groups" href="javascript:void(0)">Groups</a>
						</li>
						<!-- <li><a data-href="/userGrant.html" data-title="User Grant" href="javascript:void(0)">User Grant</a></li> -->
					</ul>
				</dd>
			</dl>

			<!-- Loaded On Demand -->
			<!-- <dl id="menu-monitor">
				<dt><i class="Hui-iconfont">&#xe6c1;</i> Perfomance Monitor<i class="Hui-iconfont menu_dropdown-arrow">&#xe6d5;</i>
				</dt>
				<dd>
					<ul>
						<li><a data-href="http://115.239.209.122:9090/" data-title="Promuthues" href="javascript:void(0)">Promuthues</a></li>
						<li><a data-href="http://115.239.209.122:9093/" data-title="Alertmanager" href="javascript:void(0)">Alertmanager</a>
						</li>
						
					</ul>
				</dd>
			</dl> -->

		</div>
	</aside>
	<!-- 导航栏折叠箭头 -->
	<div class="dislpayArrow hidden-xs"><a class="pngfix" href="javascript:void(0);" onClick="displaynavbar(this)"></a>
	</div>

	<section class="Hui-article-box">
		<div id="Hui-tabNav" class="Hui-tabNav hidden-xs">
			<div class="Hui-tabNav-wp">
				<ul id="min_title_list" class="acrossTab cl">
					<li class="active">
						<span title="nodedetail" data-href="./cluster.html">Cluster Manager</span>
						<em></em></li>
				</ul>
			</div>
			<div class="Hui-tabNav-more btn-group">
				<a id="js-tabNav-prev" class="btn radius btn-default size-S" href="javascript:;"><i
						class="Hui-iconfont">&#xe6d4;</i></a>
				<a id="js-tabNav-next" class="btn radius btn-default size-S" href="javascript:;"><i
						class="Hui-iconfont">&#xe6d7;</i></a>
			</div>
		</div>

		<div id="iframe_box" class="Hui-article">
			<div class="show_iframe">
				<div style="display:none" class="loading"></div>
				<iframe id="iframe-welcome" data-scrolltop="0" scrolling="yes" frameborder="0"
					src="/cluster.html"></iframe>
			</div>
		</div>
	</section>

	<div class="contextMenu" id="Huiadminmenu">
		<ul>
			<li id="closethis">关闭当前 </li>
			<li id="closeall">关闭全部 </li>
		</ul>
	</div>

	<!-- dialog for license -->
	<dialog id="licenseDialog" style="width: 15%;">
		<form method="dialog">
			<label id="licenseLabel" style="margin: 10px auto; font-weight: bold;">DolphinDB License:</label>
			<div id="licenseGrid"></div>
			<button class="btn btn-sm btn-info" value="cancel" id="close"
				style="position: relative; left: 40%; color: #fff; background-color:#39b3d7 ;">close</button>
		</form>
	</dialog>
	<!-- dialog for version -->
	<dialog id="versionDialog" style="width: 20%;">
		<form method="dialog">
			<label id="versionLabel" style="margin: 10px auto; font-weight: bold;">DolphinDB Version:</label>
			<div id="versionGrid" style="text-align: center;"></div>
			<button class="btn btn-sm btn-info" value="cancel" id="close"
				style="position: relative; left: 40%; color: #fff; background-color:#39b3d7 ;">close</button>
		</form>
	</dialog>
	<!-- dialog for change Password -->
	<dialog id="passwordDialog" style="width: 50%;">
		<h3 style="margin: 20px auto;width: 400px;text-align: center;">change your password</h3>
		<div id="errorMsg" style="margin: 10px auto;width: 400px;text-align: center;color: red;"></div>
		<form method="dialog">

			<div class="row cl">
				<label class="form-label col-xs-4 col-sm-2">User Name :</label>
				<div class="formControls col-xs-8 col-sm-9">
					<input type="text" id="username" class="input-text" disabled>
				</div>
			</div>
			<div class="row cl">
				<label class="form-label col-xs-4 col-sm-2">Old Password :</label>
				<div class="formControls col-xs-8 col-sm-9">
					<input type="password" id="oldPassword" class="input-text" placeholder="enter your old password">
				</div>
			</div>
			<div class="row cl">
				<label class="form-label col-xs-4 col-sm-2">New Password :</label>
				<div class="formControls col-xs-8 col-sm-9">
					<input type="password" id="newPassword" class="input-text" placeholder="enter your new password">
				</div>
			</div>
			<div class="row cl">
				<label class="form-label col-xs-4 col-sm-2">Confirm :</label>
				<div class="formControls col-xs-8 col-sm-9">
					<input type="password" id="confirmPassword" class="input-text"
						placeholder="enter your new password again">
				</div>
			</div>

			<div style="width: 160px;margin: 30px auto; ">
				<button id="confirmChangePassword" class="btn btn-primary radius" value="save"><i
						class="Hui-iconfont">&#xe632;</i> 保存</button>
				<button id="cancelChangePassword" class="btn btn-default radius"
					value="cancel">&nbsp;&nbsp;取消&nbsp;&nbsp;</button>
			</div>

		</form>
	</dialog>



	<script type="text/javascript" src="./lib/jquery/1.9.1/jquery.min.js"></script>
	<script type="text/javascript" src="./js/loadMonitorIframe.js"></script>
	<script type="text/javascript" src="./lib/layer/2.4/layer.js"></script>
	<script type="text/javascript" src="./static/h-ui/js/H-ui.min.js"></script>
	<script type="text/javascript" src="./static/h-ui.admin/js/H-ui.admin.js"></script>
	<!-- <script src="third-party/bootstrap/js/vendor/jquery-3.5.1.min.js" type="text/javascript"></script>
    <script src="third-party/bootstrap/js/vendor/jquery-migrate-1.2.1.min.js" type="text/javascript"></script> -->
	<script src="third-party/bootstrap/js/vendor/bootstrap.js" type="text/javascript"></script>
	<script src="third-party/bootstrap/js/vendor/jquery-ui.js" type="text/javascript"></script>
	<script src="third-party/bootstrap/js/docs.js" type="text/javascript"></script>
	<script src="third-party/bootstrap/js/demo.js" type="text/javascript"></script>
	<script src="js/utils.js" type="text/javascript"></script>
	<script src="third-party/jsgrid/jsgrid.js" type="text/javascript"></script>
	<script src="third-party/noty/noty.js" type="text/javascript"></script>
	<script src="third-party/gridmanager/js/GridManager.js" type="text/javascript"></script>
	<script src="third-party/jquery-tmpl/jquery.tmpl.min.js" type="text/javascript"></script>
	<script src="third-party/bootstrap/js/vendor/jquery.cookie.js" type="text/javascript"></script>
	<script src="js/datagrid.js" type="text/javascript"></script>
	<script src="js/executecode.js" type="text/javascript"></script>
	<script src="js/CallWebApi.js" type="text/javascript"></script>
	<script src="js/dialog.js" type="text/javascript"></script>
	<script src="third-party/requirejs/require.js" type="text/javascript"></script>
	<script src="js/dolphinApi.js" type="text/javascript"></script>


	<script type="text/javascript" src="./lib/jquery.contextmenu/jquery.contextmenu.r2.js"></script>
	<script type="text/javascript">
		var wa_url = "";
		$(document).ready(function () {
			// login validate
			HandleUrlOverHttp();
			wa_url = GetFullUrl(window.location.host);
			var controller = new ControllerServer(wa_url);

			if (!controller.isLeader()) {
				alert("The specified controller is a follower of a raft group. The active leader is : " + controller
					.getCurrentLeader());
			}
			//var leaderUrl = GetFullUrl(controller.getLeaderUrl());
			//if(leaderUrl!=wa_url) window.location.href = leaderUrl;
			var currentUser = controller.getCurrentUser();
			if (currentUser.userId == "guest") {
				$("#btnLogin").show();
				$("#btnAdmin").hide();

			} else {
				if (currentUser.isAdmin === 1) {
					$("#btnAdmin").append(`admin <i class="Hui-iconfont">&#xe6d5;</i>`)
				} else {
					$("#btnAdmin").append(`${currentUser.userId} <i class="Hui-iconfont">&#xe6d5;</i>`)
				}
				$("#btnLogin").hide();
				$("#btnAdmin").show();
				// set change password dialog username	
				$('#username').val(currentUser.userId)
			}
			// if not admin, display cluster and DFS only
			if (currentUser.isAdmin !== 1) {
				$("#menu-memory").hide()
				$("#menu-stramingData").hide()
				$("#menu-work").hide()
				$("#menu-functionView").hide()
				$("#menu-admin").hide()

			}

			// logout handeler
			$("#btnLogout").bind("click", function () {
				var user = JSON.parse(localStorage.getItem("DolphinDB_CurrentUsername"));
				var controller = new ControllerServer(wa_url);
				controller.logout(user.userId, function (re) {
					if (re.resultCode == "0") {
						localStorage.setItem("DolphinDB_CurrentUsername", "");
						localStorage.setItem(session_storage_id, "");
						window.location.reload();
					} else {
						alert(re.msg);
					}
				})
			});

			// license button handler
			$("#btnLicense").bind('click', function () {
				$("#licenseDialog")[0].showModal()
				var licenseList = controller.getLicense().object[0].value
				//[{…}, {…}]
				var licenseName = licenseList[0].value
				var licenseDescription = licenseList[1].value
				var licenseObj = {}
				for (var i = 0, len = licenseName.length; i < len; i++) {
					licenseObj[licenseName[i]] = licenseDescription[i]
				}
				// console.log(licenseObj);
				$("#licenseGrid").empty()
				for (item in licenseObj) {
					$("#licenseGrid").append(`<p>${item}  :  ${licenseObj[item]}</p>`)
				}


			})

			// version button handler
			$("#btnVersion").bind('click', function () {
				$("#versionDialog")[0].showModal()
				var version = controller.getVersion().object[0].value
				console.log(version);
				$("#versionGrid").empty()
				$("#versionGrid").append(`<p style="margin: 30px 0;">${version}</p>`)
			})

			// password change handler
			$('#changePassword').bind('click', function () {
				$('#passwordDialog')[0].showModal()
			})

			// cancel change password, clear form
			$('#cancelChangePassword').bind('click', function () {
				console.log('cancel');
				$('#oldPassword').val('')
				$('#newPassword').val('')
				$('#confirmPassword').val('')
				$('#errorMsg').html('')
			})

			// comfirm change, clear form
			$('#confirmChangePassword').bind('click', function () {
				console.log('submit');
				var username = $('#username').val()
				var oldPassword = $('#oldPassword').val()
				var newPassword = $('#newPassword').val()
				var confirmPassword = $('#confirmPassword').val()
				if (oldPassword === '' || newPassword === '' || confirmPassword === '') {
					$('#errorMsg').html('Password cannot be empty')
					return false
				}
				if (newPassword !== confirmPassword) {
					$('#errorMsg').html('The password entered twice is inconsistent')
					$('#confirmPassword').focus()
					return false
				}
				controller.changeUserPwd(oldPassword, newPassword, function (re) {
					console.log(re);
					if (re.resultCode === '1') {
						$("#errorMsg").html("The old password is incorrect.")
						$('#passwordDialog')[0].showModal()
					} else {
						// logout and  redirct login html
						controller.logout(username)
						window.location.href = '/login.html'
					}
				})


			})

		})
	</script>

</body>